
**Задача 1.1**

Разработать ETL-процесс для загрузки «банковских» данных из csv-файлов в соответствующие таблицы СУБД PostgreSQL. Покрыть данный процесс логированием этапов работы и всевозможной дополнительной статистикой (на ваше усмотрение). Обратите внимание, что в разных файлах может быть разный формат даты, это необходимо учитывать при загрузке.

#### **Исходные данные:**

- Файл «Структура таблиц.docx» – содержит описание и поможет создать таблицы в детальном слое DS

**Краткое описание данных таблиц:**

Таблицы DS.MD_ACCOUNT_D, DS.MD_CURRENCY_D и DS.MD_EXCHANGE_RATE_D содержат информацию о счетах, валютах и курсах валют соответственно. В данных таблицах есть поля data_actual_date и data_actual_end_date, по которым можно определить какие именно записи актуальны в нужную дату. Идентификаторы записей имеют окончание «_rk» (например, account_rk – идентификатор счета).

Таблица DS.MD_LEDGER_ACCOUNT_S – это справочник балансовых счетов. Он регулируется Центральным банком. По нему можно определить к какой главе и к каким разделам относятся счета первого (первые 3 цифры номера счета) и второго (первые 5 цифр номера счета) порядка.

Таблица DS.FT_POSTING_F – это таблица проводок (операций) в рабочем дне (поле oper_date), которая состоит из двух частей: счет дебета и счет кредита, которая изменяет баланс на сумму проводки

#### **Требования к реализации задачи:**

- В своей БД создать пользователя / схему «DS».  
    Примеры команд:  
    [https://postgrespro.ru/docs/postgresql/9.6/sql-createschema](https://postgrespro.ru/docs/postgresql/9.6/sql-createschema)
- Создать в DS-схеме таблицы под загрузку данных из csv-файлов.
- Начало и окончание работы процесса загрузки данных должно логироваться в специальную логовую таблицу. Эту таблицу нужно придумать самостоятельно. По логам должно быть видно дату и время старта и окончания загрузки, так же можете туда добавить любую дополнительную информацию, которую посчитаете нужным.
- После логирования о начале загрузки добавить таймер (паузу) на 5 секунд, чтобы чётко видеть разницу во времени между началом и окончанием загрузки. Из-за небольшого учебного объёма данных – процесс загрузки быстрый;
- Для хранения логов нужно в БД создать отдельного пользователя / схему «LOGS» и создать в этой схеме таблицу для логов;
- (В случае реализации процесса в Talend) В зависимости от мощностей рабочей станции – сделать загрузку из всех файлов одним потоком в параллели или отдельными потоками (может не хватить оперативной памяти для Java-heap);
- Для корректного обновления данных в таблицах детального слоя DS нужно выбрать правильную Update strategy и использовать следующие первичные ключи для таблиц фактов, измерений и справочников (должно быть однозначное уникальное значение, идентифицирующее каждую запись таблицы):

|   |   |
|---|---|
|**Таблица**|**Первичный ключ**|
|DS.FT_BALANCE_F|ON_DATE, ACCOUNT_RK|
|DS.FT_POSTING_F|У данной таблицы нет первичного ключа. Можно считать, что мы всегда в нее будем загружать полный набор данных, поэтому перед каждой загрузкой ее необходимо очищать.|
|DS.MD_ACCOUNT_D|DATA_ACTUAL_DATE, ACCOUNT_RK|
|DS.MD_CURRENCY_D|CURRENCY_RK, DATA_ACTUAL_DATE|
|DS.MD_EXCHANGE_RATE_D|DATA_ACTUAL_DATE, CURRENCY_RK|
|DS.MD_LEDGER_ACCOUNT_S|LEDGER_ACCOUNT, START_DATE|


